<source>
  @type tail
  path /var/log/containers/*.log
  pos_file /fluentd/log/s3-containers.log.pos
  time_format %Y-%m-%dT%H:%M:%S.%NZ
  tag kubernetes.*
  format none
  read_from_head true
</source>

<filter **>
  type kubernetes_metadata
  use_journal true
</filter>

<match **>
  @type s3
  aws_key_id admin123
  aws_sec_key admin123
  s3_endpoint http://9.21.53.161:31706/
  s3_bucket pipeline-logs
  s3_region test_region
  path logs/                    # This prefix is added to each file
  force_path_style true         # This prevents AWS SDK from breaking endpoint URL
  time_slice_format %Y%m%d%H%M  # This timestamp is added to each file name

  <buffer time>
    @type file
    path /var/log/td-agent/s3
    timekey 60s                 # Flush the accumulated chunks every xx
    timekey_wait 10s             # Wait for xx seconds before flushing
    timekey_use_utc true        # Use this option if you prefer UTC timestamps
    chunk_limit_size 20m       # The maximum size of each chunk
  </buffer>
</match>
